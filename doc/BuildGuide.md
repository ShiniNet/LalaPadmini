# ビルドガイド

> [!TIP]
> Github右上のリストボタン押下で目次（アウトライン）が表示され、工程全体を把握しやすくなります。
![2025-03-06_06h52_32](https://github.com/user-attachments/assets/600b59ae-39ec-4d79-b8a6-39246b630301)

　
## 準備
### キット内容物(詳細)の確認

| 名前 | 数 |
|:-|:-|
|PCB（左右＋エンコーダ基板）|1式|
|キーボードケース|1式|
|スイッチカバー|2個|
|マイコンカバー|2個+α|
|エンコーダーノブ|1個|
|エンコーダーカバー|1個|
|TPUマウント|8個|
|XIAOtoFPCコンバーター|2枚+α|
|トラックパッドモジュール|1個|
|FFC（フレキシブルフラットケーブル）12PIN|1個|
|ロータリーエンコーダー|1個|
|FFC（フレキシブルフラットケーブル）5PIN|1個|
|JST SHコネクタ&熱収縮チューブ※先行版のみ|2個|
|マグネット|8個|
|滑り止めシール|8枚|
|ホットスワップソケット|38個|
|17mm狭ピッチキーキャップ|38個|

![IMG_20250609_052034](https://github.com/user-attachments/assets/b6d74b11-e01c-47a3-9e3e-ea64f6599414)

<br/><br/><br/>
### 別途ご用意いただくもの

| 必須 | 名前 | 数 | 備考 |参考商品|
|:-|:-|---:|:-|:-|
|★|Seeed Studio XIAO nRF52840 |2個|マイコン本体。安価で入手性が高く、通信も安定しています。|[秋月電子](https://akizukidenshi.com/catalog/g/g117341/)|
|★|Kailh Choc V2互換スイッチ|38個|個人的にDeepSeaMiniがおすすめ。Lofreeなども適合。ChocV1も一応刺さります。|[遊舎工房](https://shop.yushakobo.jp/collections/all-switches/Kailh-Choc-V2%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81) [Kailhswitch](https://kailhswitch.net/products/kailh-deep-sea-silent-min-low-profile-keyboard-switch)|
|★|3.7Vリチウムポリマーバッテリー|2個|コネクタピッチ1.25mm、外寸厚さ6.3mm以下、長さ41mm以下、幅20mm以下。 型番としては602040もしくは602035タイプが適合します。容量は300～500mahの製品を確認済み）|[Amazon](https://www.amazon.co.jp/dp/B0D5CJLPM9/)|
|★|USB-Cケーブル|2本|充電、ファームウェア書き込み用。何百回と抜き差しする事になるのでマグネット式がおすすめ。||

### 道具類

|必須| 名前 | 備考 |参考商品|
|:-|:-|:-|:-|
|★|はんだごてセット|アマゾンの温度調整付きはんだごて改善版15点セット（ピンセット、はんだ吸い取り線、フラックス、３C型のこて先入り）がおすすめ。|[amazon](https://www.amazon.co.jp/dp/B0CM1WJB5X/)|
||糸ハンダ|使用するはんだ線によっては定着がイマイチらしい。ENGINEERのSW-41が評判良いです。|[amazon](https://www.amazon.co.jp/dp/B001D7ME7Q/)|
||フラックスクリーナー|フラックスで基板がべとべとになるので掃除用。||
||ピンセット|はんだ中のパーツ固定用。||
||マスキングテープ|マイコンを机に固定する用||
||ニッパー|基板の分離用。||
||PCB固定ホルダー|XIAOにFPCを取り付ける時に便利です。||
||テスター|あると電源投入前に配線のショートをチェックできるので怖さが減ります。またトラブル発生時の問題の特定や、サポートのやりとりするために大変有用となっています。ワニ口タイプなら細いピン等を掴む事で細かい端子までチェックができます。|[amazon](https://www.amazon.co.jp/dp/B09S6Y9RM6/)|

※参考商品は全てアフィリエイトの含まれない直リンクです

※参考商品はあくまで参考であり、全ての商品が検証済みではないことにご注意ください

<br>

 
## はんだづけ作業前の準備
- はんだごての取り扱い方が分からない事に起因するトラブルが大変多くなっております。
- はんだ付けが初めての場合、作業を始める前に以下の動画に一度目を通しておくことをお勧めいたします。
- https://youtu.be/dQ7AUjb1tkA?t=1198

![image](https://github.com/user-attachments/assets/83b540a6-6ee8-4ddb-bd2a-ac00fa3dd708)

よくあるはんだづけ注意ポイントは以下のとおりです。
- 初心者は鉛入りはんだを使う（ENGINEERのSW-41が評判よいらしい
- こて先の温度管理（330度前後推奨
- 細すぎるこて先を使わない（標準装備のB型ではなく、3C型がおすすめ
- 基板のランド＆パーツへしっかり熱を伝える（加熱時間を増やすのではなく、こて先の表面が広くランド＆パーツの両方に触れるように意識。点ではなく線もしくは面で密着するように意識。
- はんだを長時間加熱するとフラックスが蒸発して定着しなくなる。再加熱しても溶けなくなる。小手先を離した時にはんだがトガる。
- フラックスを塗布する（はんだが溶けやすくなり、パーツへの吸着が良くなる
- こて先が酸化するとはんだが溶けなくなる
- はんだごてを一時的でも使用しない時は、はんだで覆って酸化を防ぐ

<br><br>

## PCBの組み立て
### PCBの分離
- ニッパー等で赤丸で囲ったライナー部分をカットします。（素手でも折れると思います

![2025-06-09_07h14_53](https://github.com/user-attachments/assets/752e3364-d309-454b-8c44-3399d9301cb5)

<br><br>

### ホットスワップソケットのはんだづけ
- PCBの裏面の左右合計38箇所へホットスワップソケットを取り付けていきます。

> [!WARNING]
> - ソケットの向きに注意してください。ソケットのでっぱりとPCBのマークが一致するように。
> - はんだはたっぷり目で接合してください。キースイッチ着脱中にソケットが脱落する原因になります。

![2025-06-09_07h17_20](https://github.com/user-attachments/assets/5affd89f-1aa3-41f6-b430-6578d956a289)

<br><br>

### ロータリーエンコーダーのはんだづけ＆カバー取り付け
- PCBの表面からエンコーダーを差し込み、裏面から5か所はんだづけします。
- 向きに注意しつつ、エンコーダーにカバーを取り付けます。
![2025-06-09_07h19_16](https://github.com/user-attachments/assets/a1c9e39e-f734-40bf-bf32-6f0499386f0c)
![2025-06-09_11h29_23](https://github.com/user-attachments/assets/52ef4003-9ba0-4abd-be97-db4b96ea8a25)

<br><br>

### マイコンにFPCコンバーターのはんだづけ
取り付け方の動画を用意しました。

> [!TIP]
> - PCBホルダー（もしくはテープで固定する）等でしっかりマイコンを机に固定して作業することをお勧めいたします。
> - マイコン表面の極小端子についてはすでに適量のはんだが盛られているので、フラックスを塗布しFPCを上から重ね、こて先で加熱すると接合されます。

https://youtu.be/duvtfUjUrcw
![Timeline 1_01_00_24_07](https://github.com/user-attachments/assets/38b665d8-88cf-4b73-ad59-e3f4ff8a0860)

> [!TIP]
> - テスターをお持ちの場合、特にミスが起きやすいPCB表面端子のブリッジを確認できるので、この時点でトラブルに対処することができます。
> - 具体的には、RE-A、RE-B、CS1の隣り合った3端子がそれぞれショートしていないか、各端子がGNDに対してショートしていないかをチェックしてください。
> - 他の隣り合った端子も、合わせてブリッジのチェックをしておくと後のトラブルが減ります。

![2025-06-09_13h12_09](https://github.com/user-attachments/assets/878d4885-a604-444b-8ed7-14d2e4b0b250)

<br><br>

### 基板へトラックパッドとエンコーダーを接続する
![IMG_20250609_054633](https://github.com/user-attachments/assets/810cb13e-8b4b-4054-84ba-a08449702835)

<br><br>

## 動作確認
### マイコンへファームウェアの書き込み
- GitHUBに公開している[ベースファームウェア（.uf2）](https://github.com/ShiniNet/LalaPadmini/tree/main/firmware)をダウンロードします。
![2025-06-09_07h39_37](https://github.com/user-attachments/assets/4efdb119-3a3a-4a85-aacf-ba5e69d6e12e)
  
- マイコンとPCをUSBに接続した状態でマイコンのリセットボタンを2回連打します。
![IMG_20250609_054802](https://github.com/user-attachments/assets/b1f9d9be-bc8b-4c36-8d09-8151a3ac693e)

- 正しく操作できていればPC側にマイコンのフォルダ(XIAO-SENSE)が表示されるので、先ほどダウンロードした.uf2ファイル（右側には"lalapadmini_right_xxxx.uf2"、左側には"lalapadmini_left_xxxx.uf2"のファイル）を１つずつコピーペーストします。
- UF2ファイルが書き込まれると自動的にフォルダが閉じられ、マイコンが再起動し緑のランプが点灯します。
- 接続したPC側にはデバイス名"lalapadmini"として認識されます。

  ![2025-06-09_08h51_04](https://github.com/user-attachments/assets/9d76e2c9-7947-4eaa-9873-a6acdb5cf8d7)

<br><br>

### 基板へマイコン（FPC）の取り付け

![IMG_20250609_055843](https://github.com/user-attachments/assets/c960d5ed-59a5-4ac5-98eb-73deaf0d0acf)

<br><br>

### 動作確認（USB）
- FPCが破損しやすいのでUSBやFPCソケットへの抜き差しは慎重に。デバッグ中は主にPC側のUSBを抜き差しすることを推奨。
- ピンセット等でキーソケット部分を導通させ、キーの入力を確認します。
- 任意の[キーボード入力テスト用のWEBサイト](https://www.onlinemictest.com/ja/keyboard-test/)にて、動作確認を行います。
- 全ての物理キーが正しく判定されることを確認してください。
- トラックパッドによるポインタ操作、エンコーダーによるスクロールができることを確認してください。
- マイコンのリセットボタンが機能することを確認してください。

> [!WARNING]
> - 左手側を単独でテストすることはできませんので、右手側を先に起動した状態で左手側を起動しテストしてください。USB-Cケーブルが2本必要です。

> [!TIP]
> - 動作に問題がある場合、[組立のトラブルシューティング]()を参考にしてください。

![IMG_20250609_055740](https://github.com/user-attachments/assets/6c8efc35-237c-43df-820f-b43a30a9b9c0)
![2025-06-09_07h55_52](https://github.com/user-attachments/assets/f5ec6655-044c-4837-86f5-0ee3122681bf)


### 動作確認（バッテリー）
- PCとキーボードをペアリングしておきます。
- USBを取り外し、基板にバッテリーを接続し、電源をONにして同様に動作チェックをします。
- スイッチはマイコン側がON、その反対がOFFです。

> [!WARNING]
> バッテリーには極性があります。ソケットに差し込む方向に対して左側がプラス（赤色）になるバッテリーを使用してください。

> [!TIP]
> - 機器とのペアリングに問題がある場合、[トラブルシューティング](https://github.com/ShiniNet/LalaPadmini#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)を参考にしてください。

![2025-06-09_08h56_46](https://github.com/user-attachments/assets/4092aadf-44d8-4a6e-a0fe-415bc1cdb25b)


- 動作確認が済んだらトラックパッドとエンコーダーはFFCから外しておきます。
  
![IMG_20250609_060736](https://github.com/user-attachments/assets/e9d0f5fb-2505-465e-892b-a670d02dfa6b)

<br>

## キーボードの組み立て
### 基板にトッププレートとキースイッチを装着する
![2025-06-09_08h02_00](https://github.com/user-attachments/assets/2a48defb-5fbb-41b1-ad75-2e94f8905eda)

<br>

### ボトムケースにマグネットを装着
> [!WARNING]
> - マグネットには極性があります。ケースの左右で極性が反転するようにマグネットを装着し、ケース同士が磁力で引き合うようにしてください。
> - うっかり反転してマグネットを装着してしまった場合、マイナスドライバーやピンセット等を切り欠きに差し込み、マグネットを引き出してください。
  
![2025-06-15_12h41_50](https://github.com/user-attachments/assets/a91a953a-004f-4107-8844-d760acdd87f9)

<br>

### キーボードケースの組み立て
- 言語化しずらい動作が多いので動画にまとめました。

> [!WARNING]
> マイコンのFPCが大変破けやすくなっております。マイコンへのUSBの抜き差しや、ケースへの脱着時には細心の注意を払うようにしてください。

https://youtu.be/0xm0zzpwDLY
![Timeline 1_01_01_12_26](https://github.com/user-attachments/assets/02203341-76f9-433d-9d57-2833d6ec0436)

<br><br>

### トラックパッドとエンコーダーをケースに取り付ける
![2025-06-09_11h14_02](https://github.com/user-attachments/assets/f7b1d216-1fd9-4630-85de-60d53af3a4cf)
![2025-06-09_11h17_37](https://github.com/user-attachments/assets/c92f77f8-4076-4b7b-add5-1ae158b023b2)

<br>

### キーキャップを取り付けて完成！！
![IMG_20250609_070512](https://github.com/user-attachments/assets/9c1f7ed5-1cad-4634-95e5-fac464a35be8)

> [!TIP]
> [使い方](https://github.com/ShiniNet/LalaPadmini#%E4%BD%BF%E3%81%84%E6%96%B9%E6%A9%9F%E8%83%BD)を参考に、楽しい自作キーボードライフを満喫してください！


<br/><br/><br/>

# 組立のトラブルシューティング（準備中）

- DiscordのHelpチャンネルでも過去のトラブルの事例を確認することができますので、是非ご参加ください！ <BR/>
  ※招待コードはパッケージに同梱されています
- キーボードの使用方法や接続に関するトラブルシューティングは[こちら](https://github.com/ShiniNet/LalaPadmini#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)

<br/><br/>
## キーボードの1行目が動作しない（左手側QWERTなど）または、電源OFF時に充電されない
- マイコンに取り付けたFPCが裂けている可能性が高いので、予備品と交換してください。

## トラックパッドとロータリーエンコーダーが動作しない
- マイコンとFPCのはんだ不良の可能性が高いです。
- マイコンのRE-A/Bがエンコーダー、CS1がトラックパッドの動作を担っておりますので、当該端子のはんだづけを見直してみてください。
- マイコンを左右で差し替えることで、マイコンの問題か基盤側の問題か切り分けることができます。
  
![2025-06-18_20h48_49](https://github.com/user-attachments/assets/5b549f23-df74-401e-b7d9-8c1b428fc3d6)

<br>

## マイコンが起動しない
## バッテリーから給電されない充電されない

## 特定のキーが動作しない
### 行単位でキーが動作しない（ASDFGがまるごと動作しないなど）
### 列単位でキーが動作しない（EDCがまるごと動作しないなど）
### 特定の１キーが反応しない
- ホットスワップソケットのはんだづけを確認
- キースイッチのピンが折れ曲がって挿入されていないか確認
- PC側の物理配列がUSモードになっているか確認
- 割り当てしているキーコードを変更して動作するか確認

## トラックパッドが動作しない
- キーボードの電源再投入して改善するか確認
- USB接続では動作するか確認
- FFC（フレキシブルフラットケーブル）がねじれて反転して接続されていないか確認
- 左右付け替えて動作するか確認
- マイコンのはんだづけ確認
  
## ロータリーエンコーダーが動作しない
- エンコーダーのはんだづけ確認
- マイコンのはんだづけ確認
